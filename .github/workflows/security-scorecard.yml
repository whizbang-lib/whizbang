name: "OSSF Scorecard"

on:
  branch_protection_rule:
  schedule:
    - cron: '0 0 * * 0'  # Weekly on Sunday
  push:
    branches: [ main ]
  workflow_dispatch:

# Permissions are defined at job level for least-privilege principle
# See: https://docs.github.com/en/actions/security-guides/automatic-token-authentication

jobs:
  analysis:
    name: Scorecard Analysis
    runs-on: ubuntu-latest
    permissions:
      security-events: write
      id-token: write
      contents: read
      actions: read

    steps:
    - name: Checkout repository
      uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      with:
        persist-credentials: false

    - name: Run OSSF Scorecard
      uses: ossf/scorecard-action@4eaacf0543bb3f2c246792bd56e8cdeffafb205a # v2.4.3
      with:
        results_file: scorecard-results.sarif
        results_format: sarif
        publish_results: true

    - name: Upload SARIF results
      uses: github/codeql-action/upload-sarif@6bc82e05fd0ea64601dd4b465378bbcf57de0314 # v4.32.1
      with:
        sarif_file: scorecard-results.sarif
        category: ossf-scorecard

    - name: Upload results as artifact
      uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f # v4.6.2
      with:
        name: OSSF Scorecard Results
        path: scorecard-results.sarif
        retention-days: 5
