name: "OSSF Scorecard"

on:
  branch_protection_rule:
  schedule:
    - cron: '0 0 * * 0'  # Weekly on Sunday
  push:
    branches: [ main ]
  workflow_dispatch:

# Permissions are defined at job level for least-privilege principle
# See: https://docs.github.com/en/actions/security-guides/automatic-token-authentication

jobs:
  analysis:
    name: Scorecard Analysis
    runs-on: ubuntu-latest
    permissions:
      security-events: write
      id-token: write
      contents: read
      actions: read

    steps:
    - name: Checkout repository
      uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      with:
        persist-credentials: false

    - name: Run OSSF Scorecard
      uses: ossf/scorecard-action@f3b5ca7a53fe41e2ab47e52ecf1c9b8ae8db9467 # v2.4.3
      with:
        results_file: scorecard-results.sarif
        results_format: sarif
        publish_results: true

    - name: Upload SARIF results
      uses: github/codeql-action/upload-sarif@b20883b0cd1f46c72ae0ba6d1090936928f9fa30 # v4.32.0
      with:
        sarif_file: scorecard-results.sarif
        category: ossf-scorecard

    - name: Upload results as artifact
      uses: actions/upload-artifact@00ffe26b55af5ce91ffdd0c695aa704ab9a6c5e1 # v4.6.2
      with:
        name: OSSF Scorecard Results
        path: scorecard-results.sarif
        retention-days: 5
