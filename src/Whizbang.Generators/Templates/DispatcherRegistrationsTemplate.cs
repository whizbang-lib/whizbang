#region HEADER
// <auto-generated/>
// Generated at: __TIMESTAMP__
#endregion
#nullable enable

using System.Diagnostics;
using System.Diagnostics.CodeAnalysis;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.DependencyInjection.Extensions;
using Whizbang.Core;
using Whizbang.Core.Observability;

namespace Whizbang.Core.Generated {
  /// <summary>
  /// Auto-generated registrations for receptors and dispatcher.
  /// </summary>
  [ExcludeFromCodeCoverage]
  [DebuggerNonUserCode]
  public static class DispatcherRegistrations {
    /// <summary>
    /// Registers all {{RECEPTOR_COUNT}} discovered receptors with the service collection.
    /// </summary>
    [ExcludeFromCodeCoverage]
    [DebuggerNonUserCode]
    public static IServiceCollection AddReceptors(this IServiceCollection services) {
      #region RECEPTOR_REGISTRATIONS
      // This region will be replaced with receptor registration calls
      #endregion
      return services;
    }

    /// <summary>
    /// Registers the generated zero-reflection dispatcher.
    /// Automatically uses ITraceStore if registered for envelope observability.
    /// </summary>
    [ExcludeFromCodeCoverage]
    [DebuggerNonUserCode]
    public static IServiceCollection AddWhizbangDispatcher(this IServiceCollection services) {
      services.AddSingleton<IDispatcher>(sp => {
        var traceStore = sp.GetService<ITraceStore>();
        return new GeneratedDispatcher(sp, traceStore);
      });
      services.AddSingleton<Dispatcher>(sp => (GeneratedDispatcher)sp.GetRequiredService<IDispatcher>());
      return services;
    }
  }
}
